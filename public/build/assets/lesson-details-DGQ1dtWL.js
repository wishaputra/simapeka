document.addEventListener("DOMContentLoaded",function(){const i=new bootstrap.Modal(document.getElementById("lessonModal")),l=document.getElementById("lessonForm"),u=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),c=document.getElementById("lesson-type"),m=document.getElementById("lessons-table"),d=document.getElementById("content-url-group"),r=document.getElementById("content-file-group");function a(){c.value==="video"?(d.style.display="block",r.style.display="block",document.getElementById("lesson-content-file").accept=".mp4"):c.value==="pdf"?(d.style.display="none",r.style.display="block",document.getElementById("lesson-content-file").accept=".pdf"):(d.style.display="none",r.style.display="none")}c.addEventListener("change",a),document.getElementById("add-lesson").addEventListener("click",()=>{l.reset(),document.getElementById("lesson-id").value="",document.getElementById("lessonModalLabel").textContent="Add Lesson",a(),i.show()}),l.addEventListener("submit",function(s){s.preventDefault();const n=document.getElementById("lesson-id").value,t=new FormData(l),e=n?`/dev/corpu2/simapeka/public/sections/${sectionId}/lessons/${n}`:`/dev/corpu2/simapeka/public/sections/${sectionId}/lessons`;(n?"PUT":"POST")==="PUT"&&t.append("_method","PUT"),fetch(e,{method:"POST",headers:{"X-CSRF-TOKEN":u},body:t}).then(o=>{if(!o.ok)throw new Error("Network response was not ok");return o.json()}).then(o=>{o.success?location.reload():alert(o.message||"An error occurred.")}).catch(o=>{console.error("Error:",o),alert("An unexpected error occurred.")})}),m.addEventListener("click",function(s){if(s.target.classList.contains("edit-lesson")){const n=s.target.dataset.id;fetch(`/dev/corpu2/simapeka/public/sections/${sectionId}/lessons/${n}`).then(t=>{if(!t.ok)throw new Error("Failed to fetch lesson data.");return t.json()}).then(t=>{if(t.success){const e=t.lesson;document.getElementById("lesson-id").value=e.id,document.getElementById("lesson-title").value=e.title,document.getElementById("lesson-type").value=e.type,document.getElementById("lesson-duration").value=e.duration,document.getElementById("lesson-order").value=e.order,e.type==="video"&&(document.getElementById("lesson-content-url").value=e.content),a(),document.getElementById("lessonModalLabel").textContent="Edit Lesson",i.show()}else alert(t.message||"An error occurred while fetching lesson data.")}).catch(t=>{console.error(t.message),alert("Error fetching lesson data.")})}else if(s.target.classList.contains("delete-lesson")){const n=s.target.dataset.id,t=`/dev/corpu2/simapeka/public/sections/${sectionId}/lessons/${n}`;n&&confirm("Are you sure you want to delete this lesson?")&&fetch(t,{method:"DELETE",headers:{"X-CSRF-TOKEN":u}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{e.success?location.reload():alert(e.message||"An error occurred.")}).catch(e=>{console.error("Error:",e),alert("An unexpected error occurred.")})}})});
