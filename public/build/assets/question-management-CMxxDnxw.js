document.addEventListener("DOMContentLoaded",()=>{const d=new bootstrap.Modal(document.getElementById("question-modal")),r=document.getElementById("question-form"),a=document.getElementById("type"),m=document.getElementById("options-container"),p=document.getElementById("correct-answer-container"),c=document.getElementById("options-list"),h=document.getElementById("add-option"),l=document.getElementById("quiz-container").dataset.quizId,u=document.querySelector('meta[name="csrf-token"]').content;a.addEventListener("change",function(){const e=this.value==="multiple_choice";m.style.display=e?"block":"none",p.style.display=e?"block":"none",e||(c.innerHTML="")}),h.addEventListener("click",()=>{const e=document.createElement("div");e.className="input-group mb-2",e.innerHTML=`
            <input type="text" class="form-control" name="options[]" placeholder="Option text" required>
            <button class="btn btn-danger" type="button" onclick="this.parentElement.remove()">Remove</button>
        `,c.appendChild(e)}),document.getElementById("open-add-question-modal").addEventListener("click",()=>{r.reset(),r.dataset.id="",c.innerHTML="",a.dispatchEvent(new Event("change")),d.show()}),document.querySelectorAll(".edit-question").forEach(e=>{e.addEventListener("click",i=>{const t=i.target.dataset;if(r.reset(),r.dataset.id=t.id,r.querySelector("#question_text").value=t.question,r.querySelector("#type").value=t.type,r.querySelector("#points").value=t.points,a.dispatchEvent(new Event("change")),t.type==="multiple_choice"){const n=JSON.parse(t.options||"[]");c.innerHTML="",n.forEach(o=>{const s=document.createElement("div");s.className="input-group mb-2",s.innerHTML=`
                        <input type="text" class="form-control" name="options[]" value="${o}" required>
                        <button class="btn btn-danger" type="button" onclick="this.parentElement.remove()">Remove</button>
                    `,c.appendChild(s)}),r.querySelector("#correct_answer").value=t.correct||""}d.show()})}),document.getElementById("save-question").addEventListener("click",()=>{const e=new FormData(r),i=r.dataset.id;e.append("quiz_id",l);let t=`/dev/corpu2/simapeka/public/quizzes/${l}/questions`,n="POST";i&&(t=`/dev/corpu2/simapeka/public/questions/${i}`,n="PUT"),fetch(t,{method:n,body:e,headers:{"X-CSRF-TOKEN":u,Accept:"application/json"}}).then(o=>o.ok?o.json():o.text().then(s=>{throw new Error(`Server responded with ${o.status}: ${s}`)})).then(o=>{o.success?location.reload():alert(o.message||"Error saving question")}).catch(o=>{console.error("Error:",o),alert("An error occurred while saving the question. Check the console for more details.")})}),document.querySelectorAll(".delete-question").forEach(e=>{e.addEventListener("click",i=>{const t=i.target.dataset.id;confirm("Are you sure you want to delete this question?")&&fetch(`/dev/corpu2/simapeka/public/questions/${t}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":u}}).then(n=>n.json()).then(n=>{n.success?location.reload():alert(n.message||"Error deleting question")}).catch(n=>{console.error("Error:",n),alert("An error occurred while deleting the question.")})})})});
