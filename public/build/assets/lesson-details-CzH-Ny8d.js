document.addEventListener("DOMContentLoaded",function(){const r=new bootstrap.Modal(document.getElementById("lessonModal")),i=document.getElementById("lessonForm"),a=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),c=document.getElementById("lesson-type"),u=document.getElementById("lessons-table"),o=document.getElementById("content-url-group"),l=document.getElementById("content-file-group");c.addEventListener("change",function(){c.value==="video"?(o.style.display="block",l.style.display="block",document.getElementById("lesson-content-file").accept=".mp4"):c.value==="pdf"?(o.style.display="none",l.style.display="block",document.getElementById("lesson-content-file").accept=".pdf"):(o.style.display="none",l.style.display="none")}),document.getElementById("add-lesson").addEventListener("click",()=>{i.reset(),o.style.display="none",l.style.display="none",document.getElementById("lesson-id").value="",document.getElementById("lessonModalLabel").textContent="Add Lesson",r.show()}),i.addEventListener("submit",function(s){s.preventDefault();const e=document.getElementById("lesson-id").value,n=new FormData(i),t=e?`/dev/corpu2/simapeka/public/sections/${sectionId}/lessons/${e}`:`/dev/corpu2/simapeka/public/sections/${sectionId}/lessons`;fetch(t,{method:e?"PUT":"POST",headers:{"X-CSRF-TOKEN":a},body:n}).then(d=>{if(!d.ok)throw new Error("Network response was not ok");return d.json()}).then(d=>{d.success?location.reload():alert(d.message||"An error occurred.")}).catch(d=>{console.error("Error:",d),alert("An unexpected error occurred.")})}),document.querySelectorAll(".edit-lesson").forEach(s=>{s.addEventListener("click",function(){const e=JSON.parse(this.dataset.lesson||"{}");e.id?document.getElementById("lesson-id").value=e.id:document.getElementById("lesson-id").value="",document.getElementById("lesson-id").value=e.id,document.getElementById("lesson-title").value=e.title,document.getElementById("lesson-type").value=e.type,document.getElementById("lesson-duration").value=e.duration,document.getElementById("lesson-order").value=e.order,e.type==="video"?(o.style.display="block",l.style.display="block",document.getElementById("lesson-content-url").value=e.content||""):e.type==="pdf"&&(o.style.display="none",l.style.display="block"),document.getElementById("lessonModalLabel").textContent="Edit Lesson",r.show()})}),u.addEventListener("click",function(s){if(s.target.classList.contains("delete-lesson")){const e=s.target.dataset.id,n=`/dev/corpu2/simapeka/public/sections/${sectionId}/lessons/${e}`;e&&confirm("Are you sure you want to delete this lesson?")?fetch(n,{method:"DELETE",headers:{"X-CSRF-TOKEN":a}}).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.success?location.reload():alert(t.message||"An error occurred.")}).catch(t=>{console.error("Error:",t),alert("An unexpected error occurred.")}):alert("Lesson ID is missing or invalid.")}}),u.addEventListener("click",function(s){if(s.target.classList.contains("edit-lesson")){const e=s.target.dataset.id;if(!e){console.error("Lesson ID is missing.");return}fetch(`/dev/corpu2/simapeka/public/sections/${sectionId}/lessons/${e}`).then(n=>{if(!n.ok)throw new Error("Failed to fetch lesson data.");return n.json()}).then(n=>{if(n.success){const t=n.lesson;document.getElementById("lesson-id").value=t.id,document.getElementById("lesson-title").value=t.title,document.getElementById("lesson-type").value=t.type,document.getElementById("lesson-duration").value=t.duration,t.type==="video"?(c.value="video",o.style.display="block",l.style.display="block",document.getElementById("lesson-content-url").value=t.content):t.type==="pdf"&&(c.value="pdf",o.style.display="none",l.style.display="block"),document.getElementById("lessonModalLabel").textContent="Edit Lesson",r.show()}else alert(n.message||"An error occurred while fetching lesson data.")}).catch(n=>{console.error(n.message),alert("Error fetching lesson data.")})}})});
