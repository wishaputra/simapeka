document.addEventListener("DOMContentLoaded",()=>{const a=new bootstrap.Modal(document.getElementById("questionModal")),d=document.getElementById("questionForm"),i=document.getElementById("type"),u=document.getElementById("multipleChoiceFields"),s=document.getElementById("optionsContainer"),m=document.getElementById("addOptionButton"),p=document.querySelector('input[name="exam_id"]').value,l=document.querySelector('meta[name="csrf-token"]').content;i.addEventListener("change",function(){u.style.display=this.value==="multiple_choice"?"block":"none"}),m.addEventListener("click",()=>{const o=document.createElement("div");o.className="input-group mb-2",o.innerHTML=`
            <input type="text" class="form-control" name="options[]" placeholder="Option text" required>
            <button class="btn btn-danger" type="button" onclick="this.parentElement.remove()">Remove</button>
        `,s.appendChild(o)}),document.getElementById("open-add-question-modal").addEventListener("click",()=>{d.reset(),document.getElementById("questionId").value="",s.innerHTML="",i.dispatchEvent(new Event("change")),a.show()}),document.querySelectorAll(".edit-question").forEach(o=>{o.addEventListener("click",c=>{const t=c.target.dataset;if(d.reset(),document.getElementById("questionId").value=t.id,document.getElementById("questionText").value=t.question,i.value=t.type,document.getElementById("points").value=t.points,i.dispatchEvent(new Event("change")),t.type==="multiple_choice"){const n=JSON.parse(t.options||"[]");s.innerHTML="",n.forEach(r=>{const e=document.createElement("div");e.className="input-group mb-2",e.innerHTML=`
                        <input type="text" class="form-control" name="options[]" value="${r}" required>
                        <button class="btn btn-danger" type="button" onclick="this.parentElement.remove()">Remove</button>
                    `,s.appendChild(e)}),document.getElementById("correctAnswer").value=t.correct}a.show()})}),document.getElementById("save-question").addEventListener("click",o=>{o.preventDefault();const c=new FormData(d),t=document.getElementById("questionId").value;let n=`/dev/corpu2/simapeka/public/exams/${p}/questions`,r="POST";t&&(n=`/dev/corpu2/simapeka/public/questions/${t}`,r="PUT"),fetch(n,{method:r,body:c,headers:{"X-CSRF-TOKEN":l,Accept:"application/json"}}).then(e=>e.ok?e.json():e.text().then(h=>{throw new Error(`Server responded with ${e.status}: ${h}`)})).then(e=>{e.success?location.reload():alert(e.message||"Error saving question")}).catch(e=>{console.error("Error:",e),alert("An error occurred while saving the question. Check the console for more details.")})}),document.querySelectorAll(".delete-question").forEach(o=>{o.addEventListener("click",c=>{const t=c.target.dataset.id;confirm("Are you sure you want to delete this question?")&&fetch(`/dev/corpu2/simapeka/public/questions/${t}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":l,Accept:"application/json"}}).then(n=>n.json()).then(n=>{n.success?location.reload():alert(n.message||"Error deleting question")}).catch(n=>{console.error("Error:",n),alert("An error occurred while deleting the question.")})})})});
